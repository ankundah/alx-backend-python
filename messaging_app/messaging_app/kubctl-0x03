#!/bin/bash

set -e

echo "ğŸš€ Applying updated blue deployment (version 2.0)..."
kubectl apply -f blue_deployment.yaml

echo "â³ Monitoring rollout progress..."
kubectl rollout status deployment/messaging-app-blue

echo "ğŸŒ Starting curl test to check for downtime..."
# Replace service name if different
for i in {1..20}; do
  curl --max-time 2 http://localhost:8000/ || echo "âš ï¸ Request failed"
  sleep 2
done

echo "âœ… Checking current pods after rollout..."
kubectl get pods -l app=messaging-app,version=blue -o wide
